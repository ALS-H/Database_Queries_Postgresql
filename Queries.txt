1.Get all predictions
---------------------------------
SELECT * FROM cardiodiagnosis;

-----------------------------------
2.Get all predictions for the day (a specific day)
----------------------------------
SELECT * FROM cardiodiagnosis
WHERE date::date='2019-05-03';
---------------------------------------------------------
3.Get all the predictions for the day and sort them based on the highest probability percentage at 
the top. 
-------------------------------------------------------

SELECT
    cardioarrestdetected,
    COUNT(*) AS occurrence_count
FROM cardiodiagnosis
WHERE date::date = '2019-05-25'
GROUP BY cardioarrestdetected
ORDER BY occurrence_count DESC;

-------------------------------------------------------
4.Get all the unique cities. 
-----------------------------
SELECT DISTINCT city
FROM addressinfo;
--------------------------------
5.Get all the members who are from a city 'Burgos'. 
---------------------------------------------------------
SELECT memberinfo_member_id from addressinfo where city='Burgos';
-------------------------------------------------------------

6.Get all the members who are from 'Flora' city. 
-------------------------------------------------
SELECT memberinfo_member_id from addressinfo where city='Flora';
-------------------------------------------------

7.Get the total number of blood tests done for Aisha.

----------------------------------------------------
select count(*) as total_blood_tests
from bloodtest b
join cardiodiagnosis c
on b.cardiodiagnosis_cardio_id=c.cardio_id
join memberinfo m
on c.memberinfo_member_id=m.member_id
where m.firstname='aisha';
-------------------------------------------------

8.Get the X-ray details of Ajay whose cardio test was done on 26th of Jan 2019.
-----------------------------------------------------------
SELECT *
FROM xray x
JOIN cardiodiagnosis c
  ON x.cardiodiagnosis_cardio_id = c.cardio_id
JOIN memberinfo m
  ON c.memberinfo_member_id = m.member_id
WHERE m.firstname ILIKE  'ajay'
  AND c.date::DATE = '2019-01-26';
---------------------------------------------------------------

9.Get all the members who are from cities 'Burgos' and 'Flora'.
-----------------------------------------------------------------
select * from memberinfo m
join addressinfo a
on m.member_id=a.memberinfo_member_id
where a.city in ('Burgos','Flora');
------------------------------------------------------------

10.Get the total number of blood tests done for Aberson.
----------------------------------------------------------
SELECT COUNT(*) AS total_blood_tests
FROM bloodtest b
JOIN cardiodiagnosis c
  ON b.cardiodiagnosis_cardio_id = c.cardio_id
JOIN memberinfo m
  ON c.memberinfo_member_id = m.member_id
WHERE m.lastname ILIKE 'Aberson';
-------------------------------------------------------------

11. Get all address details for member ID M303. 
--------------------------------------------------------------
select a.address_id,a.city,a.state,a.country,a.pincode from addressinfo a
join memberinfo m
on a.memberinfo_member_id=m.member_id
where m.member_id='M303';
------------------------------------------------------------
12.. Get all X-ray details for cardio ID CID122.
----------------------------------------------------
select x.xray_id,x.date,x.ca from xray x
join cardiodiagnosis c
on x.cardiodiagnosis_cardio_id=c.cardio_id
where c.cardio_id='cid122';
---------------------------------------------------------
13.Get all symptom details whose cardio ID is CID250 and CID300.
----------------------------------------------------------------
select s.symptom_id,s.date,s.exang,s.oldpeak,s.cp from symptom s
join cardiodiagnosis c
on s.cardiodiagnosis_cardio_id=c.cardio_id
where c.cardio_id in ('cid250','cid300');
------------------------------------------------------------------
14.Get all symptom details for the month of July and year 2019. 
-----------------------------------------------------------------
SELECT *
FROM symptom
WHERE date >= '2019-07-01'
  AND date <  '2019-08-01';
---------------------------------------------------------------------
15.Get X-ray details for the member with the last name "Dailley". 
----------------------------------------------------------------------
select x.xray_id,x.date,x.ca from xray x
join cardiodiagnosis c
on x.cardiodiagnosis_cardio_id=c.cardio_id
join memberinfo m
on c.memberinfo_member_id=m.member_id
where m.lastname ILIKE 'Dailley';
-------------------------------------------------------------------------
16. Get wearable device data details for cardio IDs between CID100 and CID200.
----------------------------------------------------------------------------
SELECT 
    w.wearable_device_id,
    w.thalach,
    w.slope,
    w.date
FROM wearabledevicedata w
JOIN cardiodiagnosis c
  ON w.cardiodiagnosis_cardio_id = c.cardio_id
WHERE c.cardio_id BETWEEN 'cid100' AND 'cid200';

----------------------------------------------------------------------------
17. Display all cardio diagnosis details where the first name starts with the letter "A".
--------------------------------------------------------------------------------------
select c.cardio_id,c.cardioarrestdetected,c.date from cardiodiagnosis c
join memberinfo m
on c.memberinfo_member_id=m.member_id
where m.firstname ILIKE 'A%';
-----------------------------------------------------------------------------------------
18.Display all cardio diagnosis details where the first name starts with "A" and ends with "A".
-----------------------------------------------------------------------------------------
select c.cardio_id,c.cardioarrestdetected,c.date from cardiodiagnosis c
join memberinfo m
on c.memberinfo_member_id=m.member_id
where m.firstname ILIKE 'A%A';
-----------------------------------------------------------------------------------------
19. Get all the members from the MemberInfo table.
--------------------------------------------------------------------
select * from memberinfo;
---------------------------------------------------------------------------
20.Get all the addresses of members.
-----------------------------------------------------------
select * from addressinfo;
----------------------------------------------------------
21. Get a list of wearable device information. 
----------------------------------------------------------------------
SELECT * FROM wearabledevicedata;
------------------------------------------------------------------
22. Get a list of all the blood tests done. 
------------------------------------------------------------------
select * from bloodtest;

-----------------------------------------------------------------------
23.Get a list of members who are aged greater than 50. 
--------------------------------------------------------------------------
select * from memberinfo where age>50;

--------------------------------------------------------------------------
24.Get a list of addresses for the city 'Flora'.
-------------------------------------------------------------------------------
select * from addressinfo where city='Flora';

---------------------------------------------------------------------------
25.Get a list of all unique states. 
--------------------------------------------------------------------------
select distinct state from addressinfo;

-------------------------------------------------------------------------------
26.Get the total number of members in the database
-------------------------------------------------------------------------------
select count(*) as total_no_of_members from memberinfo;

-------------------------------------------------------------------------------
27.Get the total number of blood tests done. 
-------------------------------------------------------
select count(*) as total_bloodtests from bloodtest;

---------------------------------------------------------
28.Get the average cholesterol level for members. 
---------------------------------------------------------
select avg(b.serumcholesterol) as avg_cholestrol_for_members from 
bloodtest b join cardiodiagnosis c on b.cardiodiagnosis_cardio_id=c.cardio_id;

-------------------------------------------------------
29. Get the maximum peak value in symptoms. 

-----------------------------------------------------------------
select max(oldpeak) as max_peak_value from symptom;

----------------------------------------------------
30.. Get the list of tests done between January 1, 2015, and January 31, 2019.
------------------------------------------------------------------------------
SELECT 'Blood Test' AS test_type, blood_id AS test_id, date, cardiodiagnosis_cardio_id
FROM bloodtest
WHERE date >= '2015-01-01'
  AND date <  '2019-02-01'

UNION ALL

SELECT 'ECG Report' AS test_type, ecg_id AS test_id, date, cardiodiagnosis_cardio_id
FROM ecgreport
WHERE date >= '2015-01-01'
  AND date <  '2019-02-01'

UNION ALL

SELECT 'Symptom' AS test_type, symptom_id AS test_id, date, cardiodiagnosis_cardio_id
FROM symptom
WHERE date >= '2015-01-01'
  AND date <  '2019-02-01'

UNION ALL

SELECT 'Wearable Device' AS test_type, wearable_device_id AS test_id, date, cardiodiagnosis_cardio_id
FROM wearabledevicedata
WHERE date >= '2015-01-01'
  AND date <  '2019-02-01'

UNION ALL

SELECT 'X-Ray' AS test_type, xray_id AS test_id, date, cardiodiagnosis_cardio_id
FROM xray
WHERE date >= '2015-01-01'
  AND date <  '2019-02-01';


----------------------------------------------------------
31.Get the number of males and females aged between 50 and 60. 
-------------------------------------------------------------
SELECT gender, COUNT(*) FROM memberinfo
WHERE age BETWEEN 50 AND 60
GROUP BY gender;

--------------------------------------------------------------
32.Get the list of tests where blood pressure is between 100 and 200. 
-------------------------------------------------------------------
select * from bloodtest where bloodpressure between 100 and 200;

----------------------------------------------------------------------
33. Get the list of symptoms diagnosed for patients. 
----------------------------------------------------------------------
select * from symptom;

------------------------------------------------------------
34. Get the average age of patients in the database. 
--------------------------------------------------------
select avg(age) as avg_age_patients from memberinfo;

--------------------------------------------------------------
35. Get the total number of cities for each state available. 
----------------------------------------------------------
select state, count(distinct city) as total_cities from addressinfo group by state;

--------------------------------------------------------------------
36. Get the number of patients in the following age groups: 
o 10-20 
o 20-30 
o 30-40 
o 40-50 
o 50-60 
o 60-70
------------------------------------------------------------
SELECT
    CASE
        WHEN age BETWEEN 10 AND 20 THEN '10-20'
        WHEN age BETWEEN 21 AND 30 THEN '20-30'
        WHEN age BETWEEN 31 AND 40 THEN '30-40'
        WHEN age BETWEEN 41 AND 50 THEN '40-50'
        WHEN age BETWEEN 51 AND 60 THEN '50-60'
        WHEN age BETWEEN 61 AND 70 THEN '60-70'
    END AS age_group,
    COUNT(*) AS total_patients
FROM memberinfo
WHERE age BETWEEN 10 AND 70
GROUP BY age_group
ORDER BY age_group;


----------------------------------------------------------------------
37. Get the list of members and their addresses. 
------------------------------------------------------------------
select * from memberinfo m join addressinfo a on m.member_id=a.memberinfo_member_id;

----------------------------------------------------------------------------------

38.Get the list of members and their cardio history.
--------------------------------------------------------------
SELECT *
FROM memberinfo m
LEFT JOIN cardiodiagnosis c
  ON m.member_id = c.memberinfo_member_id;

#to get people who do not have cardio history
---------------------------------------------------------------------------------------

39. Get the list of members and their diseases.
------------------------------------------------------------
select * from memberinfo m left join cardiodiagnosis c on m.member_id=c.memberinfo_member_id left join diseasedetails d on c.cardio_id=d.cardiodiagnosis_cardio_id;

----------------------------------------------------------------------------------------------
40.Get the list of females diagnosed with a heart attack.
-----------------------------------------------------------------------------------

select m.member_id,m.username,m.firstname,m.lastname,m.age,m.gender,m.email,m.phonenumber from memberinfo m join cardiodiagnosis c on m.member_id=c.memberinfo_member_id where m.gender='0' and c.cardioarrestdetected=true;

-------------------------------------------------------------------------------------
41.Get the list of female members and their cardio information for those aged above 50. 
---------------------------------------------------------------------------------------
select * from memberinfo m left join cardiodiagnosis c on m.member_id=c.memberinfo_member_id where m.gender='0' and m.age>50;

-------------------------------------------------------------------------------------------
42. Get the list of males who have blood pressure > 140 and have not had a heart attack.
------------------------------------------------------------------------------------------select m.member_id,m.username,m.firstname,m.lastname,m.age,m.gender,m.email,m.phonenumber from memberinfo m join cardiodiagnosis c on m.member_id=c.memberinfo_member_id join bloodtest b on c.cardio_id=b.cardiodiagnosis_cardio_id where m.gender='1' and b.bloodpressure>140 and c.cardioarrestdetected=false;

-----------------------------------------------------------------------------------
43.Get the list of members who had a heart attack from the state "Mountain Province".
--------------------------------------------------------------------------------------
select m.member_id,m.username,m.firstname,m.lastname,m.age,m.gender,m.email,m.phonenumber,a.state from cardiodiagnosis c join memberinfo m on c.memberinfo_member_id=m.member_id join addressinfo a on m.member_id=a.memberinfo_member_id where c.cardioarrestdetected=true and a.state='Mountain Province';

----------------------------------------------------------------------------------------------
44.Get the list of male members and their diseases with symptoms for those aged less than 40. 
----------------------------------------------------------------------------------------------------
select m.member_id,m.firstname,m.lastname,m.age,m.gender,d.disease_id,d.diagnoseddate, d.recovereddate,
d.isrecovered,s.symptom_id,s.date,s.exang,s.oldpeak,s.cp
from memberinfo m join cardiodiagnosis c on m.member_id=c.memberinfo_member_id 
join diseasedetail d on c.cardio_id=d.cardiodiagnosis_cardio_id
join symptom s on d.cardiodiagnosis_cardio_id=s.cardiodiagnosis_cardio_id
where m.gender='1' and m.age<40;

--------------------------------------------------------------------------------------------------
45. Get the count of members from "Mountain Province" aged between 50 and 60.
-----------------------------------------------------------------------------------------------
SELECT COUNT(*) AS members_aged_50_60
FROM memberinfo m
JOIN addressinfo a
  ON m.member_id = a.memberinfo_member_id
WHERE a.state = 'Mountain Province'
  AND m.age BETWEEN 50 AND 60;

---------------------------------------------------------------------------------------------------
46.Get the count of male and female members who have blood pressure > 140 and have been 
detected with a heart attack. 
---------------------------------------------------------------------------------------------------
select m.gender,count(*) as total_members from memberinfo m 
join cardiodiagnosis c on m.member_id=c.memberinfo_member_id
join bloodtest b on c.cardio_id=b.cardiodiagnosis_cardio_id 
where c.cardioarrestdetected=true and b.bloodpressure>140
group by m.gender;

----------------------------------------------------------------------------------------------------
47. Get the average blood pressure of people aged between 40-50 and 50-60. 
-------------------------------------------------------------------------------------------------------
select 
	case
		when m.age between 40 and 50 then '40-50'
		when m.age between 51 and 60 then '50-60'
	end as age_groups,
avg(b.bloodpressure) as avg_bp 
from memberinfo m
join cardiodiagnosis c
on m.member_id=c.memberinfo_member_id 
join bloodtest b
on c.cardio_id=b.cardiodiagnosis_cardio_id
where m.age between 40 and 60
group by age_groups
order by age_groups;

-------------------------------------------------------------------------------------------------------
48. Get the list of diseases for people with high blood pressure in the range of 120-180, sorted by 
gender. 
-----------------------------------------------------------------------------------------------------------

select m.gender,m.member_id,m.firstname,m.lastname,d.disease_id,d.diagnoseddate,
d.recovereddate,d.isrecovered,d.isrecovered,b.bloodpressure
from memberinfo m join cardiodiagnosis c
on m.member_id=c.memberinfo_member_id
join bloodtest b
on c.cardio_id=cardiodiagnosis_cardio_id
join diseasedetail d on b.cardiodiagnosis_cardio_id=d.cardiodiagnosis_cardio_id
where b.bloodpressure between 120 and 180
order by m.gender;

-------------------------------------------------------------------------------------------------------------
49.Get the count of people who have had their X-rays every month from the state of "Special 
Province".
-----------------------------------------------------------------------------------------------------------

select date_trunc('month',x.date) as month,
count(distinct m.member_id) as people_count
from xray x
join cardiodiagnosis c
  on x.cardiodiagnosis_cardio_id = c.cardio_id
join memberinfo m
  on c.memberinfo_member_id = m.member_id
join addressinfo a
  on m.member_id = a.memberinfo_member_id
where a.state='Special Provinces'
group by month
order by month;

------------------------------------------------------------------------------------------------------------
50. Get the average age of people diagnosed with a heart attack for each state, broken down by male 
and female. 
------------------------------------------------------------------------------------------------------

select a.state,
	case 
		when m.gender='1' then 'Male'
		when m.gender='0' then 'Female'
	end as gender,
avg(m.age) as avg_age 
from cardiodiagnosis c join memberinfo m
on c.memberinfo_member_id=m.member_id 
join addressinfo a
on m.member_id=a.memberinfo_member_id 
where c.cardioarrestdetected=true
group by a.state,m.gender
order by a.state,m.gender;

---------------------------------------------------------------------------------------------------
51. Get the count of people for each state diagnosed with a heart attack, who have a slope value of 2, 
and have had at least one X-ray and one symptom.
----------------------------------------------------------------------------------------------

SELECT
    state,
    COUNT(*) AS people_count
FROM (
    SELECT
        a.state,
        m.member_id
    FROM memberinfo m
    JOIN addressinfo a
      ON m.member_id = a.memberinfo_member_id
    JOIN cardiodiagnosis c
      ON m.member_id = c.memberinfo_member_id
    JOIN wearabledevicedata w
      ON c.cardio_id = w.cardiodiagnosis_cardio_id
    LEFT JOIN xray x
      ON c.cardio_id = x.cardiodiagnosis_cardio_id
    LEFT JOIN symptom s
      ON c.cardio_id = s.cardiodiagnosis_cardio_id
    WHERE c.cardioarrestdetected = TRUE
      AND w.slope = 2
    GROUP BY a.state, m.member_id
    HAVING COUNT(DISTINCT x.xray_id) >= 1
       AND COUNT(DISTINCT s.symptom_id) >= 1
) t
GROUP BY state
ORDER BY state;

--------------------------------------------------------------------------------------------
# t is the subquery table name (temporary)


